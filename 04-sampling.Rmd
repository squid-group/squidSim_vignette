# Sampling 

We can simulate some data:

```{r}
pop_data <- simulate_population(
  data_structure=make_structure("nest(10)/individual(20)",repeat_obs=20),
  parameters = list(
    individual = list( 
      vcov = 0.1
    ),
    observation= list(
      names = c("environment"),
      beta =c(0.5)
    ), 
    residual = list(
      vcov = 0.8
    )
  )
)

```

To sample this data, we can use the `sample_population` function, for example:
```{r, eval=FALSE}
sample_population(pop_data, type = "nested", param = cbind(individual=c(10, 15),observation=c(10, 5)), plot=FALSE)
```

There are three different types of sampling 'nested', 'missing' and 'temporal', each of which are outlined below.

Sample population updates the squid data object, and you can then use 
the function `get_sample_data()` to extract the sampled data. 


## Nested

Nested sampling assumes that you have a nested structure 

```{r}


param = cbind(individual=c(10, 15),observation=c(10, 5))

```



## Missing data

`sample_population()` implements the three classes of missing data 
- **M**issing **C**ompletely **A**t **R**andom (MCAR)
- **M**issing **A**t **R**andom (MAR)
- **M**issing **N**ot **A**t **R**andom (MNAR)

through a logistic regression
<!--
Logistic function - probability of being sampled
	MNAR Y = beta_1 * body size
	MNAR Y = beta_1 * (temp +residual)
	MAR Y = beta_2*temp
-->

### MCAR
Missing completely at random occurs when the probability of missingness is not dependent on anything. This can be implemented through a logistic regression, where only the intercept is specified:
$$ logit(p) = beta_0 $$

Note this intercept is on the logit scale, so 0 is equivalent to 0.5.

```{r}
sample_data <- sample_population(pop_data, type = "missing", param = "0", plot=FALSE)
```

### MAR
Missing  at random occurs when the probability of missingness is dependent on a predictor variable (or a variables correlated with y). This can be implemented through a logistic regression, where the predictor variable(s) is a predictor(s) of y:
$$ logit(p) = beta_0 + beta_1*environment $$ 
```{r}
sample_data <- sample_population(pop_data, type = "missing", param = "0.5*environment", plot=FALSE)
```
The predictor variables are scaled (mean 0, variance 1), so the slopes are directly comparable across traits, and intercept represents the mean (on the logit scale).

### MNAR
Missing not at random occurs when the probability of missingness is dependent on the response variable itself variable (i.e. y). This can be implemented through a logistic regression, where the predictor variable is y:
$$ logit(p) = beta_0 + beta_1*y $$ 
Again y is scaled.

```{r}
sample_data <- sample_population(pop_data, type = "missing", param = "0.5*y", plot=FALSE)
```	


## Temporal Sampling

In the parameters we specify a list, with the temporal variable `time`, the grouping variable with which the temporal sampling occurs `group`, the between group variance (as a proportion) in sampling times `variance` and the within group sample size `N`:
```{r}
sample_data <- sample_population(pop_data, type = "temporal", param = list(time = c("day"), group = c("individual"), variance = c(0.1), N=4), plot=FALSE)

```
