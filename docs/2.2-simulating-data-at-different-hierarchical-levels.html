<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2.2 Simulating data at different hierarchical levels | The {squidSim} R Package Vignette</title>
  <meta name="description" content="This is a vignette for using the squidSim R package." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="2.2 Simulating data at different hierarchical levels | The {squidSim} R Package Vignette" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a vignette for using the squidSim R package." />
  <meta name="github-repo" content="squid-group/squid" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2.2 Simulating data at different hierarchical levels | The {squidSim} R Package Vignette" />
  
  <meta name="twitter:description" content="This is a vignette for using the squidSim R package." />
  

<meta name="author" content="Joel Pick" />


<meta name="date" content="2022-03-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="2.1-makestr.html"/>
<link rel="next" href="2.3-factors.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>The {squidSim} R package</a>
<ul>
<li class="chapter" data-level="0.0.1" data-path="index.html"><a href="index.html#squid-ethos"><i class="fa fa-check"></i><b>0.0.1</b> SQuID ethos</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-use-squidsim"><i class="fa fa-check"></i>Why use squidSim?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#using-the-vignette"><i class="fa fa-check"></i>Using the vignette</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i>Installation</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#issues-and-bugs"><i class="fa fa-check"></i>Issues and bugs</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="1-linearmod.html"><a href="1-linearmod.html"><i class="fa fa-check"></i><b>1</b> Simulating population data</a>
<ul>
<li class="chapter" data-level="1.1" data-path="1.1-simulate_population-function.html"><a href="1.1-simulate_population-function.html"><i class="fa fa-check"></i><b>1.1</b> <code>simulate_population</code> function</a></li>
<li class="chapter" data-level="1.2" data-path="1.2-simple-linear-model.html"><a href="1.2-simple-linear-model.html"><i class="fa fa-check"></i><b>1.2</b> Simple Linear Model</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="1.2-simple-linear-model.html"><a href="1.2-simple-linear-model.html#adding-more-information-about-the-predictors"><i class="fa fa-check"></i><b>1.2.1</b> Adding more information about the predictors</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="1.3-corpred.html"><a href="1.3-corpred.html"><i class="fa fa-check"></i><b>1.3</b> Correlated predictors</a></li>
<li class="chapter" data-level="1.4" data-path="1.4-interactions.html"><a href="1.4-interactions.html"><i class="fa fa-check"></i><b>1.4</b> Interactions and non-linear effects</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="1.4-interactions.html"><a href="1.4-interactions.html#interactions-1"><i class="fa fa-check"></i><b>1.4.1</b> Interactions</a></li>
<li class="chapter" data-level="1.4.2" data-path="1.4-interactions.html"><a href="1.4-interactions.html#non-linear-effects"><i class="fa fa-check"></i><b>1.4.2</b> Non-linear effects</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="1.5-transformations.html"><a href="1.5-transformations.html"><i class="fa fa-check"></i><b>1.5</b> Transformations</a></li>
<li class="chapter" data-level="1.6" data-path="1.6-known-predictors.html"><a href="1.6-known-predictors.html"><i class="fa fa-check"></i><b>1.6</b> Known Predictors</a></li>
<li class="chapter" data-level="1.7" data-path="1.7-nonGaussian.html"><a href="1.7-nonGaussian.html"><i class="fa fa-check"></i><b>1.7</b> Non-Gaussian phenotypes</a></li>
<li class="chapter" data-level="1.8" data-path="1.8-modeleq.html"><a href="1.8-modeleq.html"><i class="fa fa-check"></i><b>1.8</b> Model equations</a></li>
<li class="chapter" data-level="1.9" data-path="1.9-npop.html"><a href="1.9-npop.html"><i class="fa fa-check"></i><b>1.9</b> Simulating multiple populations</a></li>
<li class="chapter" data-level="1.10" data-path="1.10-parameter-list-summary.html"><a href="1.10-parameter-list-summary.html"><i class="fa fa-check"></i><b>1.10</b> Parameter list summary</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-hierarchical.html"><a href="2-hierarchical.html"><i class="fa fa-check"></i><b>2</b> Hierarchical structure</a>
<ul>
<li class="chapter" data-level="2.1" data-path="2.1-makestr.html"><a href="2.1-makestr.html"><i class="fa fa-check"></i><b>2.1</b> Making a hierarchical structure</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="2.1-makestr.html"><a href="2.1-makestr.html#single-factor"><i class="fa fa-check"></i><b>2.1.1</b> Single Factor</a></li>
<li class="chapter" data-level="2.1.2" data-path="2.1-makestr.html"><a href="2.1-makestr.html#nested-factors"><i class="fa fa-check"></i><b>2.1.2</b> Nested factors</a></li>
<li class="chapter" data-level="2.1.3" data-path="2.1-makestr.html"><a href="2.1-makestr.html#crossed-factors"><i class="fa fa-check"></i><b>2.1.3</b> Crossed factors</a></li>
<li class="chapter" data-level="2.1.4" data-path="2.1-makestr.html"><a href="2.1-makestr.html#temporal-structure"><i class="fa fa-check"></i><b>2.1.4</b> Temporal structure</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="2.2-simulating-data-at-different-hierarchical-levels.html"><a href="2.2-simulating-data-at-different-hierarchical-levels.html"><i class="fa fa-check"></i><b>2.2</b> Simulating data at different hierarchical levels</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="2.2-simulating-data-at-different-hierarchical-levels.html"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#simulating-random-effects"><i class="fa fa-check"></i><b>2.2.1</b> Simulating ‘random effects’</a></li>
<li class="chapter" data-level="2.2.2" data-path="2.2-simulating-data-at-different-hierarchical-levels.html"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#incorporating-existing-data-structures"><i class="fa fa-check"></i><b>2.2.2</b> Incorporating existing data structures</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="2.3-factors.html"><a href="2.3-factors.html"><i class="fa fa-check"></i><b>2.3</b> Factors</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="2.3-factors.html"><a href="2.3-factors.html#fixed-factor-interactions"><i class="fa fa-check"></i><b>2.3.1</b> Fixed Factor Interactions</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="2.4-randomslopes.html"><a href="2.4-randomslopes.html"><i class="fa fa-check"></i><b>2.4</b> Random slopes</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-multivariate.html"><a href="3-multivariate.html"><i class="fa fa-check"></i><b>3</b> Multi-response Models</a>
<ul>
<li class="chapter" data-level="3.1" data-path="3.1-one-response-repeatedly-measured-the-other-not.html"><a href="3.1-one-response-repeatedly-measured-the-other-not.html"><i class="fa fa-check"></i><b>3.1</b> One response repeatedly measured, the other not</a></li>
<li class="chapter" data-level="3.2" data-path="3.2-different-distributions.html"><a href="3.2-different-distributions.html"><i class="fa fa-check"></i><b>3.2</b> Different distributions</a></li>
<li class="chapter" data-level="3.3" data-path="3.3-multivariate-random-slopes.html"><a href="3.3-multivariate-random-slopes.html"><i class="fa fa-check"></i><b>3.3</b> Multivariate Random Slopes</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-animal.html"><a href="4-animal.html"><i class="fa fa-check"></i><b>4</b> Genetic effects</a>
<ul>
<li class="chapter" data-level="4.1" data-path="4.1-va.html"><a href="4.1-va.html"><i class="fa fa-check"></i><b>4.1</b> Additive genetics effects</a></li>
<li class="chapter" data-level="4.2" data-path="4.2-multivariate-genetic-effects.html"><a href="4.2-multivariate-genetic-effects.html"><i class="fa fa-check"></i><b>4.2</b> Multivariate genetic effects</a></li>
<li class="chapter" data-level="4.3" data-path="4.3-sex-specific-genetic-variance-and-inter-sexual-genetic-correlations.html"><a href="4.3-sex-specific-genetic-variance-and-inter-sexual-genetic-correlations.html"><i class="fa fa-check"></i><b>4.3</b> Sex specific genetic variance and inter-sexual genetic correlations</a></li>
<li class="chapter" data-level="4.4" data-path="4.4-gxe.html"><a href="4.4-gxe.html"><i class="fa fa-check"></i><b>4.4</b> GxE</a></li>
<li class="chapter" data-level="4.5" data-path="4.5-indirect-genetic-effects.html"><a href="4.5-indirect-genetic-effects.html"><i class="fa fa-check"></i><b>4.5</b> Indirect Genetic Effects</a></li>
<li class="chapter" data-level="4.6" data-path="4.6-dominance.html"><a href="4.6-dominance.html"><i class="fa fa-check"></i><b>4.6</b> Dominance</a></li>
<li class="chapter" data-level="4.7" data-path="4.7-inbreeding-depression.html"><a href="4.7-inbreeding-depression.html"><i class="fa fa-check"></i><b>4.7</b> Inbreeding depression</a></li>
<li class="chapter" data-level="4.8" data-path="4.8-genetic-groups.html"><a href="4.8-genetic-groups.html"><i class="fa fa-check"></i><b>4.8</b> Genetic Groups</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-phylogenetic.html"><a href="5-phylogenetic.html"><i class="fa fa-check"></i><b>5</b> Phylogenetic Effects</a>
<ul>
<li class="chapter" data-level="5.1" data-path="5.1-brownian-motion.html"><a href="5.1-brownian-motion.html"><i class="fa fa-check"></i><b>5.1</b> Brownian motion</a></li>
<li class="chapter" data-level="5.2" data-path="5.2-ornsteinuhlenbeck-process.html"><a href="5.2-ornsteinuhlenbeck-process.html"><i class="fa fa-check"></i><b>5.2</b> Ornstein–Uhlenbeck Process</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="6-temporal-and-spatial-effects.html"><a href="6-temporal-and-spatial-effects.html"><i class="fa fa-check"></i><b>6</b> Temporal and Spatial Effects</a>
<ul>
<li class="chapter" data-level="6.1" data-path="6.1-simple-temporal-effects.html"><a href="6.1-simple-temporal-effects.html"><i class="fa fa-check"></i><b>6.1</b> Simple Temporal Effects</a></li>
<li class="chapter" data-level="6.2" data-path="6.2-cyclical-temporal-effects.html"><a href="6.2-cyclical-temporal-effects.html"><i class="fa fa-check"></i><b>6.2</b> Cyclical Temporal Effects</a></li>
<li class="chapter" data-level="6.3" data-path="6.3-temporalauto.html"><a href="6.3-temporalauto.html"><i class="fa fa-check"></i><b>6.3</b> Temporal Autocorrelation</a></li>
<li class="chapter" data-level="6.4" data-path="6.4-spatialauto.html"><a href="6.4-spatialauto.html"><i class="fa fa-check"></i><b>6.4</b> Spatial Autocorrelation</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="7-sampling.html"><a href="7-sampling.html"><i class="fa fa-check"></i><b>7</b> Sampling</a>
<ul>
<li class="chapter" data-level="7.1" data-path="7.1-nested.html"><a href="7.1-nested.html"><i class="fa fa-check"></i><b>7.1</b> Nested</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="7.1-nested.html"><a href="7.1-nested.html#worked-example-1"><i class="fa fa-check"></i><b>7.1.1</b> Worked example 1</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="7.2-missing-data.html"><a href="7.2-missing-data.html"><i class="fa fa-check"></i><b>7.2</b> Missing data</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="7.2-missing-data.html"><a href="7.2-missing-data.html#mcar"><i class="fa fa-check"></i><b>7.2.1</b> MCAR</a></li>
<li class="chapter" data-level="7.2.2" data-path="7.2-missing-data.html"><a href="7.2-missing-data.html#mar"><i class="fa fa-check"></i><b>7.2.2</b> MAR</a></li>
<li class="chapter" data-level="7.2.3" data-path="7.2-missing-data.html"><a href="7.2-missing-data.html#mnar"><i class="fa fa-check"></i><b>7.2.3</b> MNAR</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="7.3-temporal-sampling.html"><a href="7.3-temporal-sampling.html"><i class="fa fa-check"></i><b>7.3</b> Temporal Sampling</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The {squidSim} R Package Vignette</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="simulating-data-at-different-hierarchical-levels" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Simulating data at different hierarchical levels</h2>
<!-- <div class="panel panel-success">
<div class="panel-heading">
**Biological example**
</div>
<div class="panel-body">
We have taken repeated measurements of adult body mass.  
</div>
</div> -->
<p>We can simulate predictors at different hierarchical levels. Lets take the example of a situation where we have repeated measures of individuals. The individuals have traits that are consistently expressed, whilst the environment varies between observations. We can describe variation at these different hierarchical levels as:</p>
<div class="alert alert-info">
<p><span class="math display">\[
y = \beta_0 + \boldsymbol Z_j \boldsymbol\beta_z + \boldsymbol X_i \boldsymbol\beta_x + \epsilon_{i,j}
\]</span>
<span class="math display">\[
\boldsymbol X \sim MVN(\mu_x,\Sigma_x)
\]</span>
<span class="math display">\[
\boldsymbol Z \sim MVN(\mu_z,\Sigma_z)
\]</span>
<span class="math display">\[
\epsilon \sim N(0,\sigma^2_\epsilon)
\]</span></p>
</div>
<p>where <span class="math inline">\(Z\)</span> is a matrix of predictors at the individual level, and <span class="math inline">\(X\)</span> is a matrix of predictors at the observation level.</p>
<p>In order to simulate from this model, we need a data structure and parameters for each of these levels.
To do this, we can either specify a data structure generated using <code>make_structure</code> (outlined in the previous section <a href="2.1-makestr.html#makestr">2.1</a>), or a pre-existing data structure, to the <code>simulate_population</code> function. We then add in a item to the parameter list, the name of which matches on of the grouping factors in the data structure, and specify the parameters for predictors that vary at that level in the same way as outlined in the previous section (<a href="1-linearmod.html#linearmod">1</a>).</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb91-1" aria-hidden="true" tabindex="-1"></a>squid_data <span class="ot">&lt;-</span> <span class="fu">simulate_population</span>(</span>
<span id="cb91-2"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_structure =</span> <span class="fu">make_structure</span>(<span class="at">structure =</span> <span class="st">&quot;individual(500)&quot;</span>, <span class="at">repeat_obs=</span><span class="dv">2</span>),</span>
<span id="cb91-3"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">parameters =</span> <span class="fu">list</span>(</span>
<span id="cb91-4"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb91-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">individual =</span> <span class="fu">list</span>(</span>
<span id="cb91-5"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb91-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">names =</span> <span class="fu">c</span>(<span class="st">&quot;size&quot;</span>,<span class="st">&quot;behaviour&quot;</span>,<span class="st">&quot;physiology&quot;</span>),</span>
<span id="cb91-6"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb91-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">beta =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.3</span>,<span class="fl">0.2</span>)</span>
<span id="cb91-7"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb91-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb91-8"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb91-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">observation =</span> <span class="fu">list</span>(</span>
<span id="cb91-9"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb91-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">names=</span><span class="fu">c</span>(<span class="st">&quot;temperature&quot;</span>,<span class="st">&quot;rainfall&quot;</span>),</span>
<span id="cb91-10"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb91-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">beta =</span> <span class="fu">c</span>(<span class="fl">0.2</span>,<span class="sc">-</span><span class="fl">0.1</span>)</span>
<span id="cb91-11"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb91-11" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb91-12"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb91-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">residual =</span> <span class="fu">list</span>(</span>
<span id="cb91-13"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb91-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">vcov =</span> <span class="fl">0.5</span></span>
<span id="cb91-14"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb91-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb91-15"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb91-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb91-16"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb91-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb91-17"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb91-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-18"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb91-18" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">get_population_data</span>(squid_data)</span>
<span id="cb91-19"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb91-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-20"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb91-20" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">lm</span>(y <span class="sc">~</span> size <span class="sc">+</span> behaviour <span class="sc">+</span> physiology <span class="sc">+</span> temperature <span class="sc">+</span> rainfall , data))</span></code></pre></div>
<pre><code>##  (Intercept)         size    behaviour   physiology  temperature     rainfall 
## -0.004619823  0.113363827  0.300209126  0.213696150  0.173801551 -0.069308797</code></pre>
<p>Here, we have simulated 5 predictors, ‘size’, ‘behaviour’ and ‘physiology’ that vary at the level of the individual, and ‘temperature’ and ‘rainfall’ that vary at the level of the observation. To keep things simple, we will simulate them all as unit normal variables (mean=0 and variance=1). Note, <strong>the names of the different grouping factors in the parameter list needs to exactly match those in the data structure</strong>. The order does not, however, have to be the same. There are circumstances in which we may want to simulate two sets of effects at the same hierarchical level (for example see permanent environment effects in Section <a href="4.1-va.html#va">4.1</a>), in this case we can call them different things in the parameter list, but link them back to the grouping factor, by providing a <code>group</code> name. For example the following will produce the same simulation as above:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-1" aria-hidden="true" tabindex="-1"></a>squid_data <span class="ot">&lt;-</span> <span class="fu">simulate_population</span>(</span>
<span id="cb93-2"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_structure =</span> <span class="fu">make_structure</span>(<span class="at">structure =</span> <span class="st">&quot;individual(500)&quot;</span>, <span class="at">repeat_obs=</span><span class="dv">2</span>),</span>
<span id="cb93-3"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">parameters =</span> <span class="fu">list</span>(</span>
<span id="cb93-4"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">ind1 =</span> <span class="fu">list</span>(</span>
<span id="cb93-5"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">group=</span><span class="st">&quot;individual&quot;</span>,</span>
<span id="cb93-6"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">names =</span> <span class="fu">c</span>(<span class="st">&quot;size&quot;</span>),</span>
<span id="cb93-7"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">beta =</span> <span class="fu">c</span>(<span class="fl">0.1</span>)</span>
<span id="cb93-8"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb93-9"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ind2 =</span> <span class="fu">list</span>(</span>
<span id="cb93-10"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">group=</span><span class="st">&quot;individual&quot;</span>,</span>
<span id="cb93-11"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">names =</span> <span class="fu">c</span>(<span class="st">&quot;behaviour&quot;</span>,<span class="st">&quot;physiology&quot;</span>),</span>
<span id="cb93-12"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">beta =</span> <span class="fu">c</span>(<span class="fl">0.3</span>,<span class="fl">0.2</span>)</span>
<span id="cb93-13"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb93-14"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">observation =</span> <span class="fu">list</span>(</span>
<span id="cb93-15"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">names=</span><span class="fu">c</span>(<span class="st">&quot;temperature&quot;</span>,<span class="st">&quot;rainfall&quot;</span>),</span>
<span id="cb93-16"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">beta =</span> <span class="fu">c</span>(<span class="fl">0.2</span>,<span class="sc">-</span><span class="fl">0.1</span>)</span>
<span id="cb93-17"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-17" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb93-18"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">residual =</span> <span class="fu">list</span>(</span>
<span id="cb93-19"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">vcov =</span> <span class="fl">0.5</span></span>
<span id="cb93-20"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb93-21"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb93-22"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb93-22" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>It is also worth noting that predictors do not have to be simulated for every grouping factor in the data structure.</p>
<div id="simulating-random-effects" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Simulating ‘random effects’</h3>
<!-- I would replace “this is simulating “ to something more explicit, like “In essence, running mixed models requires to simulate datasets with repeated values for individuals. This can be done by simulating a single combined predictor at each level…” -->
<p>In essence, random effects (random intercepts) are an unobserved/latent predictor (or group of predictors), which varies at a given hierarchical level. In a mixed effect model, the effect at each level of the grouping factor is unknown, and estimated by the model (and assumed to come from a normal distribution). When simulating this, however, we can simply simulate an additional predictor at a particular level (<span class="math inline">\(z\)</span>) with mean 0 and a given variance (<span class="math inline">\(\sigma^2_z\)</span>).</p>
<div class="alert alert-info">
<p><span class="math display">\[
y_{i,j} = \beta_0 + z_j + \epsilon_{i,j}
\]</span>
<span class="math display">\[
z \sim N(0,\sigma^2_z)
\]</span>
<span class="math display">\[
\epsilon \sim N(0,\sigma^2_\epsilon)
\]</span></p>
</div>
<p>For example we can simulate some between-individual variation as follows:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb94-1" aria-hidden="true" tabindex="-1"></a>squid_data <span class="ot">&lt;-</span> <span class="fu">simulate_population</span>(</span>
<span id="cb94-2"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_structure =</span> <span class="fu">make_structure</span>(<span class="at">structure =</span> <span class="st">&quot;individual(500)&quot;</span>, <span class="at">repeat_obs=</span><span class="dv">2</span>),</span>
<span id="cb94-3"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">parameters =</span> <span class="fu">list</span>(</span>
<span id="cb94-4"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">individual =</span> <span class="fu">list</span>(</span>
<span id="cb94-5"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb94-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">vcov =</span> <span class="fl">0.5</span></span>
<span id="cb94-6"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb94-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb94-7"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb94-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">residual =</span> <span class="fu">list</span>(</span>
<span id="cb94-8"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb94-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">vcov =</span> <span class="fl">0.5</span></span>
<span id="cb94-9"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb94-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb94-10"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb94-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb94-11"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb94-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb94-12"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb94-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-13"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb94-13" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">get_population_data</span>(squid_data)</span>
<span id="cb94-14"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb94-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span></code></pre></div>
<pre><code>##             y individual_effect    residual individual squid_pop
## 1: -1.2079359        -1.0257919 -0.18214399          1         1
## 2: -2.3019686        -1.0257919 -1.27617664          1         1
## 3:  0.7622309         0.3815617  0.38066920          2         1
## 4:  1.7634982         0.3815617  1.38193656          2         1
## 5: -0.5656264        -0.6821035  0.11647709          3         1
## 6: -0.6447769        -0.6821035  0.03732662          3         1</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb96-2"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb96-2" aria-hidden="true" tabindex="-1"></a>short_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">print</span>(<span class="fu">summary</span>(x), <span class="at">correlation=</span><span class="cn">FALSE</span>, <span class="at">show.resids=</span><span class="cn">FALSE</span>, <span class="at">ranef.comp =</span> <span class="fu">c</span>(<span class="st">&quot;Variance&quot;</span>))</span>
<span id="cb96-3"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="fu">short_summary</span>(<span class="fu">lmer</span>(y <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>individual), data))</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: y ~ 1 + (1 | individual)
##    Data: data
## 
## REML criterion at convergence: 2650.7
## 
## Random effects:
##  Groups     Name        Variance
##  individual (Intercept) 0.4916  
##  Residual               0.4699  
## Number of obs: 1000, groups:  individual, 500
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept) -0.02446    0.03812  -0.642</code></pre>
<p>Note that here we haven’t specified any variable names. In this case the simulated predictors are named by the grouping factors (e.g. individual_effects).</p>
</div>
<div id="incorporating-existing-data-structures" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Incorporating existing data structures</h3>
<p>We could also use an existing data structure, taking the grouping factors and levels from an existing dataset and input them to <code>simulate_population</code>. To demonstrate this, we can use the <a href="https://rdrr.io/cran/MCMCglmm/man/BTdata.html">blue tit dataset</a> provided with the MCMCglmm package. This is a dataset with some continuous variables (tarsus, back (coloration) and hatchdate), and some grouping factors (animal, dam, fosternest and sex), the latter providing a data structure from which to simulate.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MCMCglmm)</span>
<span id="cb98-2"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(BTdata)</span>
<span id="cb98-3"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(BTdata)</span></code></pre></div>
<pre><code>##        tarsus       back  animal     dam fosternest  hatchdate  sex
## 1 -1.89229718  1.1464212 R187142 R187557      F2102 -0.6874021  Fem
## 2  1.13610981 -0.7596521 R187154 R187559      F1902 -0.6874021 Male
## 3  0.98468946  0.1449373 R187341 R187568       A602 -0.4279814 Male
## 4  0.37900806  0.2555847 R046169 R187518      A1302 -1.4656641 Male
## 5 -0.07525299 -0.3006992 R046161 R187528      A2602 -1.4656641  Fem
## 6 -1.13519543  1.5577219 R187409 R187945      C2302  0.3502805  Fem</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb100-1" aria-hidden="true" tabindex="-1"></a>squid_data <span class="ot">&lt;-</span> <span class="fu">simulate_population</span>(</span>
<span id="cb100-2"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_structure =</span> BTdata[,<span class="fu">c</span>(<span class="st">&quot;dam&quot;</span>,<span class="st">&quot;fosternest&quot;</span>)],</span>
<span id="cb100-3"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">parameters =</span> <span class="fu">list</span>(</span>
<span id="cb100-4"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb100-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">dam =</span> <span class="fu">list</span>(</span>
<span id="cb100-5"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb100-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">vcov =</span> <span class="fl">0.2</span></span>
<span id="cb100-6"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb100-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb100-7"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb100-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">fosternest =</span> <span class="fu">list</span>(</span>
<span id="cb100-8"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb100-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">vcov =</span> <span class="fl">0.3</span></span>
<span id="cb100-9"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb100-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb100-10"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb100-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">residual =</span> <span class="fu">list</span>(</span>
<span id="cb100-11"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb100-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">vcov =</span> <span class="fl">0.5</span></span>
<span id="cb100-12"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb100-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb100-13"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb100-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb100-14"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb100-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb100-15"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb100-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-16"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb100-16" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">get_population_data</span>(squid_data)</span>
<span id="cb100-17"><a href="2.2-simulating-data-at-different-hierarchical-levels.html#cb100-17" aria-hidden="true" tabindex="-1"></a>data</span></code></pre></div>
<pre><code>##               y  dam_effect fosternest_effect   residual     dam fosternest
##   1:  0.9341310  0.47570613        0.19132612  0.2670988 R187557      F2102
##   2:  2.4709091  0.49003687        1.26942996  0.7114423 R187559      F1902
##   3: -0.8876028 -0.49521486       -0.56947508  0.1770872 R187568       A602
##   4: -1.3056287 -0.07032347       -0.24634675 -0.9889585 R187518      A1302
##   5: -0.8498537 -0.10370246       -0.49850826 -0.2476430 R187528      A2602
##  ---                                                                       
## 824: -0.3160093  0.02331247        0.01608296 -0.3554047 K983388      H1102
## 825:  2.2909789  0.97609293       -0.04340071  1.3582867 R186903       H702
## 826: -0.4200143  0.22324257        0.03865625 -0.6819131 R187535       H502
## 827:  0.5804389 -0.33236969       -0.05291349  0.9657221 R186911       H302
## 828: -0.7293586 -0.47923466        0.92423544 -1.1743594 R187001       H102
##      squid_pop
##   1:         1
##   2:         1
##   3:         1
##   4:         1
##   5:         1
##  ---          
## 824:         1
## 825:         1
## 826:         1
## 827:         1
## 828:         1</code></pre>
<!-- The importing a real dataset is very cool! But, I think there needs to be more explanation. How does this work when dam, fosternest, and residual lists are empty of variable names? Can you use the variances in the data instead of specifying them?
 -->
<!-- getME(mod,"theta")
library(numDeriv)
fm1Fun <- update(mod,devFunOnly=TRUE)
fm1_thpar <- getME(mod,"theta")
h <- hessian(fm1Fun, fm1_thpar)
sqrt(diag(solve(h)))

mySumm2 <- function(.) {
    c(beta=fixef(.),sigma=sigma(.), sig01=unlist(VarCorr(.)))
}
bootMer(mod,mySumm2,nsim = 100) -->
<!-- This setup also allows us to create variation at each level that is driven by specific predictors -->
<!-- 
Dave: At the bit just before Fixed Factors, what do you mean by “This setup”? It implies the data file import action in the previous section, which makes no sense. 
Anne: the sentence “This setup also allows us to create variation at each level that is driven by specific predictors” comes out of the blue, and I find the wording ‘this setup’ too unspecific.

-->
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="2.1-makestr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="2.3-factors.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
